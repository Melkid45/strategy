ScrollTrigger.normalizeScroll(!0),gsap.ticker.lagSmoothing(0),ScrollTrigger.config({limitCallbacks:!0,ignoreMobileResize:!0,autoRefreshEvents:"visibilitychange,DOMContentLoaded,load"});const lenis=new Lenis({duration:window.innerWidth<=750?.8:1.2,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e)),smoothWheel:!0,smoothTouch:window.innerWidth>750,touchMultiplier:window.innerWidth<=750?1:2,wheelMultiplier:1,infinite:!1,autoRaf:!1});let rafId;function raf(e){lenis.raf(e),rafId=requestAnimationFrame(raf)}rafId=requestAnimationFrame(raf),document.addEventListener("visibilitychange",(()=>{document.hidden?cancelAnimationFrame(rafId):rafId=requestAnimationFrame(raf)}));let lastScrollTop=0,isScrollingDown=!1;const scrollThreshold=5,activationThreshold=50;lenis.on("scroll",(({scroll:e})=>{ScrollTrigger.update(),requestAnimationFrame((()=>{currentScroll=e;const t=document.querySelector(".header");t&&(Math.abs(currentScroll-lastScrollTop)>5&&(isScrollingDown=currentScroll>lastScrollTop,lastScrollTop=currentScroll),isScrollingDown&&currentScroll>50&&window.innerWidth>750?t.classList.add("back"):t.classList.remove("back"))}))}));let isMobile=window.innerWidth<=750;if(isMobile&&gsap.config({force3D:!1,autoSleep:60,nullTargetWarn:!1}),window.addEventListener("resize",(()=>{isMobile=window.innerWidth<=750,lenis.options.duration=isMobile?.8:1.2,lenis.options.smoothTouch=!isMobile,lenis.options.touchMultiplier=isMobile?1:2,ScrollTrigger.refresh()})),document.querySelector(".gallery")){new Splide(".gallery-splide",{perPage:1,perMove:1,autoplay:!isMobile,interval:5e3,type:"fade",rewind:!0,drag:!0,swipe:!0}).mount(),setTimeout((()=>{document.querySelector(".gallery-splide").clientWidth;let e=document.querySelectorAll(".splide__pagination__page"),t=document.querySelector(".splide__pagination");if(t&&e.length>0){const i=parseFloat(getComputedStyle(t).gap)||0;let n=(t.clientWidth-(e.length+1)*i)/e.length;$(".splide__pagination__page").css({width:`${n}`})}}),100)}$(".menu-scrolling").on("click",(function(e){$(this).children(".burger").toggleClass("open"),$(".header").toggleClass("open")})),$(".header-menu-mob li").on("click",(function(e){$(".menu-scrolling").children(".burger").removeClass("open"),$(".header").removeClass("open")}));class AgencyTrail{constructor(e){this.agency=e,this.animationContainer=this.agency.querySelector(".wrap-agency-animation"),this.animationContainer?(this.isValid=!0,this.content=this.animationContainer.querySelector(".content"),this.content||(this.content=this.agency.querySelector(".content")),this.images=Array.from(this.content.querySelectorAll(".content__img")),this.imgInners=Array.from(this.content.querySelectorAll(".content__img-inner")),this.mouse={x:0,y:0},this.lastMouse={x:0,y:0},this.cacheMouse={x:0,y:0},this.zIndex=1,this.activeIndex=0,this.activeImagesCount=0,this.isIdle=!0,this.isPaused=!1,this.activationDistance=80,this.animationRect=this.animationContainer.getBoundingClientRect(),this.activeAnimations=new Map,this.hideAnimation=null,this.init()):this.isValid=!1}init(){this.isValid&&(this.hideAllImages(),this.setupEventListeners(),this.startTracking())}setupEventListeners(){this.isValid&&(this.animationContainer.addEventListener("mousemove",(e=>{this.updateAnimationRect(),this.mouse.x=e.clientX-this.animationRect.left,this.mouse.y=e.clientY-this.animationRect.top})),this.animationContainer.addEventListener("mouseenter",(e=>{this.isPaused=!1,this.updateAnimationRect(),this.mouse.x=e.clientX-this.animationRect.left,this.mouse.y=e.clientY-this.animationRect.top,this.cacheMouse.x=this.mouse.x,this.cacheMouse.y=this.mouse.y,this.lastMouse.x=this.mouse.x,this.lastMouse.y=this.mouse.y,this.hideAnimation&&(this.hideAnimation.kill(),this.hideAnimation=null)})),this.animationContainer.addEventListener("mouseleave",(e=>{this.isCursorInAnimationContainer(e)||(this.isPaused=!0,this.hideAllImagesSmoothly())})),document.addEventListener("mousemove",(e=>{this.isPaused&&this.isCursorInAnimationContainer(e)&&(this.isPaused=!1,this.hideAnimation&&(this.hideAnimation.kill(),this.hideAnimation=null),this.updateAnimationRect(),this.mouse.x=e.clientX-this.animationRect.left,this.mouse.y=e.clientY-this.animationRect.top,this.cacheMouse.x=this.mouse.x,this.cacheMouse.y=this.mouse.y,this.lastMouse.x=this.mouse.x,this.lastMouse.y=this.mouse.y)})),window.addEventListener("resize",(()=>{this.updateAnimationRect()})))}isCursorInAnimationContainer(e){const t=this.animationContainer.getBoundingClientRect();return e.clientX>=t.left-2&&e.clientX<=t.right+2&&e.clientY>=t.top-2&&e.clientY<=t.bottom+2}updateAnimationRect(){this.animationRect=this.animationContainer.getBoundingClientRect()}startTracking(){this.isValid&&gsap.ticker.add((()=>{this.isPaused||(this.cacheMouse.x=this.lerp(this.cacheMouse.x,this.mouse.x,.1),this.cacheMouse.y=this.lerp(this.cacheMouse.y,this.mouse.y,.1),this.checkDistanceAndSpawn())}))}lerp(e,t,i){return e+(t-e)*i}getDistance(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}checkDistanceAndSpawn(){this.getDistance(this.lastMouse,this.mouse)>this.activationDistance&&(this.spawnImage(),this.lastMouse={...this.mouse}),this.isIdle&&1!==this.zIndex&&(this.zIndex=1)}spawnImage(){if(this.isPaused||!this.isValid)return;this.activeImagesCount++,this.isIdle=!1,this.zIndex++,this.activeIndex=this.activeIndex<this.images.length-1?this.activeIndex+1:0;const e=this.images[this.activeIndex],t=this.imgInners[this.activeIndex];this.activeAnimations.has(e)&&this.activeAnimations.get(e).kill();const i=e.getBoundingClientRect();gsap.set(e,{x:this.mouse.x-i.width/2,y:this.mouse.y-i.height/2,scale:0,opacity:1,zIndex:this.zIndex}),gsap.set(t,{scale:2.8,filter:"brightness(150%)"});const n=gsap.timeline({onStart:()=>this.onImageActivate(),onComplete:()=>{this.onImageComplete(),this.activeAnimations.delete(e)}});this.activeAnimations.set(e,n),n.to(e,{duration:.4,ease:"power1.out",scale:1},0).to(t,{duration:.6,ease:"power1.out",scale:1,filter:"brightness(100%)"},0).to(e,{duration:.4,ease:"power2.in",opacity:0,scale:.2},.45)}hideAllImages(){this.isValid&&(this.images.forEach((e=>{gsap.set(e,{opacity:0,scale:.2})})),this.activeAnimations.forEach(((e,t)=>{e.kill()})),this.activeAnimations.clear(),this.hideAnimation&&(this.hideAnimation.kill(),this.hideAnimation=null),this.activeImagesCount=0,this.isIdle=!0,this.zIndex=1)}hideAllImagesSmoothly(){if(!this.isValid)return;this.activeAnimations.forEach(((e,t)=>{e.kill()})),this.activeAnimations.clear(),this.hideAnimation&&this.hideAnimation.kill();const e=this.images.filter((e=>gsap.getProperty(e,"opacity")>0));if(0===e.length)return this.activeImagesCount=0,void(this.isIdle=!0);this.hideAnimation=gsap.timeline({onComplete:()=>{this.activeImagesCount=0,this.isIdle=!0,this.zIndex=1,this.hideAnimation=null}}),e.forEach((e=>{const t=gsap.getProperty(e,"scale");gsap.getProperty(e,"opacity");this.hideAnimation.to(e,{duration:.3,ease:"power2.out",opacity:0,scale:.5*t,overwrite:!0},0)}))}onImageActivate(){this.activeImagesCount++}onImageComplete(){this.activeImagesCount--,0===this.activeImagesCount&&(this.isIdle=!0)}}class AgencyTrailManager{constructor(){this.agencyTrails=[],this.init()}init(){document.querySelectorAll(".agency").forEach((e=>{if(e.querySelector(".wrap-agency-animation")){const t=new AgencyTrail(e);t.isValid&&this.agencyTrails.push(t)}}))}}function autoResize(e){e&&(e.style.height="auto",e.style.height=e.scrollHeight+"px",updateScrollDelayed())}document.addEventListener("DOMContentLoaded",(()=>{width>750&&new AgencyTrailManager})),window.innerWidth>750&&(document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll(".item-rotate");if(!e.length)return;window.addEventListener("mousemove",(t=>{const i=window.innerWidth/2,n=15*((t.clientX-i)/i);e.forEach((e=>{gsap.to(e,{rotate:n,duration:.5,ease:"power3.out"})}))})),window.addEventListener("mouseleave",(()=>{e.forEach((e=>{gsap.to(e,{rotate:0,duration:1,ease:"power3.out"})}))}))})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("pupil");if(!e)return;const t=e.closest("svg");if(!e||!t)return;window.addEventListener("mousemove",(i=>{const n=t.getBoundingClientRect(),s=n.left+n.width/2,o=n.top+n.height/2,r=i.clientX-s,a=i.clientY-o,c=Math.atan2(a,r),l=Math.min(8,Math.hypot(r,a)),d=60+Math.cos(c)*l,h=60+Math.sin(c)*l;gsap.to(e,{attr:{cx:d,cy:h},duration:.2,ease:"power2.out"})})),window.addEventListener("mouseleave",(()=>{gsap.to(e,{attr:{cx:60,cy:60},duration:.3,ease:"power2.out"})}))})));const textarea=document.querySelector("textarea");function updateScrollDelayed(){gsap.delayedCall(.35,(()=>{"undefined"!=typeof ScrollTrigger&&ScrollTrigger.refresh(!0),void 0!==lenis&&("function"==typeof lenis.resize&&lenis.resize(),lenis.scrollTo(lenis.scroll,{immediate:!0})),window.dispatchEvent(new Event("resize"))}))}function handleAccordionClick(e){const t=e.siblings(".item"),i=e.hasClass("open");t.removeClass("open"),i?e.removeClass("open"):e.addClass("open"),updateScrollDelayed()}autoResize(textarea),textarea&&textarea.addEventListener("input",(()=>autoResize(textarea))),$(".services-frame .item").on("click",(function(){handleAccordionClick($(this))})),$(".faq-frame .item").on("click",(function(){handleAccordionClick($(this))}));let width=$(window).width();width<750?$(".desk").remove():$(".mob").remove();let isReady=!1;function initAnchorLinks(){document.querySelectorAll('a[href^="#"]').forEach((e=>{e.addEventListener("click",(t=>{if(t.preventDefault(),!isReady)return void console.warn("⛔ Якоря пока не готовы — ждем инициализацию Lenis/GSAP");const i=e.getAttribute("href");if(!i||"#"===i)return;const n=document.querySelector(i);n&&(ScrollTrigger.refresh(!0),requestAnimationFrame((()=>{const e=n.parentNode;let t=n;if(e.classList.contains("pin-spacer")){const i=e.previousElementSibling;if(i){const e=i.clientHeight||0;t=i.offsetTop+e}}lenis.scrollTo(t,{lerp:.1,duration:6,easing:e=>e<.5?2*e*e:(4-2*e)*e-1}),setTimeout((()=>{ScrollTrigger.refresh(!0)}),500)})))}))}))}window.addEventListener("load",(()=>{const e=()=>{if("undefined"==typeof gsap||"undefined"==typeof ScrollTrigger||void 0===lenis)return console.warn("⏳ Ждем GSAP / ScrollTrigger / Lenis..."),requestAnimationFrame(e);gsap.delayedCall(.3,(()=>{ScrollTrigger.refresh(!0),lenis.scrollTo(0,{immediate:!0,duration:.1}),requestAnimationFrame((()=>{requestAnimationFrame((()=>{initAnchorLinks(),isReady=!0,console.log("✅ Anchor links initialized (GSAP + Lenis ready)")}))}))}))};setTimeout(e,300)})),window.addEventListener("resize",(()=>{"undefined"!=typeof controller&&controller.update(!0),ScrollTrigger.refresh(!0)})),window.addEventListener("hashchange",(()=>{ScrollTrigger.refresh(!0)})),void 0!==lenis&&lenis.on("scroll",(()=>{ScrollTrigger.update()})),width>750&&function(){const e={x:window.innerWidth/2,y:window.innerHeight/2,prevX:window.innerWidth/2,prevY:window.innerHeight/2,speed:0,isHovering:!1},t=document.getElementById("cursorTrail"),i=document.getElementById("cursorDot"),n=[];for(let i=0;i<10;i++){const i=document.createElement("div");i.className="cursor-dot tail",t.appendChild(i),n.push({el:i,x:e.x,y:e.y,scale:1,opacity:0})}function s(t){const i=t.clientX||t.touches&&t.touches[0].clientX||e.x,n=t.clientY||t.touches&&t.touches[0].clientY||e.y;e.speed=Math.hypot(i-e.prevX,n-e.prevY),e.prevX=e.x,e.prevY=e.y,e.x=i,e.y=n,function(t,i){const n=document.elementFromPoint(t,i);if(n){const t="A"===n.tagName||"BUTTON"===n.tagName||"pointer"===n.style.cursor||"pointer"===window.getComputedStyle(n).cursor;e.isHovering=t}else e.isHovering=!1}(i,n)}function o(e,t,i){return e+(t-e)*i}window.addEventListener("pointermove",s,{passive:!0}),window.addEventListener("touchmove",s,{passive:!0}),function t(){e.speed*=.85,requestAnimationFrame(t)}(),requestAnimationFrame((function t(){const s=o(parseFloat(i.dataset.scale||1),e.isHovering?1.2:1,.2);i.dataset.scale=s,i.style.transform=`translate3d(${e.x}px, ${e.y}px,0) translate(-50%, -50%) scale(${s})`;const r=e.speed>1.5;for(let t=0;t<n.length;t++){const i=0===t?{x:e.x,y:e.y}:n[t-1],s=n[t];s.x=o(s.x,i.x,.15+.015*t),s.y=o(s.y,i.y,.15+.015*t);let a=1;if(r){a+=Math.min(e.speed/25,1)*(1-t/n.length)*1.6}s.scale=o(s.scale,a,.08),s.el.style.transform=`translate3d(${s.x}px, ${s.y}px,0) translate(-50%, -50%) scale(${s.scale})`;const c=e.speed<.1?0:.2*(1-t/n.length);s.opacity=o(s.opacity,c,.1),s.el.style.opacity=s.opacity.toFixed(2)}requestAnimationFrame(t)}))}();class DotCanvas{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.resize(),this.spacing=48,this.dots=[],this.initDots(),this.cursor={x:this.w/2,y:this.h/2,tx:this.w/2,ty:this.h/2,vx:0,vy:0,speed:0},this.setupEventListeners(),this.animate()}resize(){this.w=this.canvas.width=this.canvas.offsetWidth,this.h=this.canvas.height=this.canvas.offsetHeight}initDots(){if(0!==this.w&&0!==this.h)for(let e=this.spacing/2;e<this.h;e+=this.spacing)for(let t=this.spacing/2;t<this.w;t+=this.spacing)this.dots.push({x:t,y:e,r:2,targetR:2,opacity:.5,targetOpacity:.5})}setupEventListeners(){this.handleMouseMove=e=>{const t=this.canvas.getBoundingClientRect();this.cursor.tx=e.clientX-t.left,this.cursor.ty=e.clientY-t.top},this.handleResize=()=>{this.resize(),this.dots=[],this.initDots()},window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("resize",this.handleResize)}draw(){this.ctx.clearRect(0,0,this.w,this.h);let e=this.cursor.tx-this.cursor.x,t=this.cursor.ty-this.cursor.y;this.cursor.vx+=.2*e,this.cursor.vy+=.2*t,this.cursor.vx*=.7,this.cursor.vy*=.7,this.cursor.x+=this.cursor.vx,this.cursor.y+=this.cursor.vy,this.dots.forEach((e=>{const t=Math.hypot(e.x-this.cursor.x,e.y-this.cursor.y);t<120?(e.targetR=1+(120-t)/50,e.targetOpacity=.5):(e.targetR=.5,e.targetOpacity=0),e.r+=.1*(e.targetR-e.r),e.opacity+=.1*(e.targetOpacity-e.opacity),this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.r,0,2*Math.PI),this.ctx.fillStyle=`rgba(255,255,255,${e.opacity})`,this.ctx.fill()}))}animate(){this.draw(),requestAnimationFrame((()=>this.animate()))}destroy(){window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("resize",this.handleResize)}}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("dotCanvas");e&&width>750&&new DotCanvas(e)})),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".file-wrap");if(!e)return;const t=e.querySelector('input[type="file"]'),i=e.querySelector(".clear-file"),n=e.querySelector(".file-name");t.addEventListener("change",(function(){this.files&&this.files.length>0?(e.classList.add("has-file"),n.textContent=this.files[0].name):(e.classList.remove("has-file"),n.textContent="Прикрепить файл")})),i.addEventListener("click",(function(i){i.preventDefault(),i.stopPropagation(),t.value="",e.classList.remove("has-file"),n.textContent="Прикрепить файл"}))})),$(".wrap-answer .item").on("click",(function(e){let t=$(this).text();$("#custom-select").val(t)}));let col=0;$(".form-action button").on("click",(function(e){document.querySelectorAll(".input-wrap input, .input-wrap textarea").forEach(((e,t)=>{""===e.value?(e.classList.add("error"),e.classList.remove("has-val")):(col++,e.classList.remove("error"),e.classList.add("has-val"))})),5==col&&($(".feedback-form-main").remove(),$(".form-send").fadeIn(300),$(".form-default").remove())}));let resizeTimeout,IsDestop=width>750;if(document.querySelector(".hero-block")){let e={scale:IsDestop?15:30,yPercent:IsDestop?100:350,xPercent:IsDestop?-70:-0,end:IsDestop?"+=75%":"+=100%"};gsap.to(".hero-block .circle-hero",{scale:e.scale,yPercent:e.yPercent,xPercent:e.xPercent,scrollTrigger:{trigger:".hero-block",start:"top+=0.5%",end:e.end,scrub:1,pin:!0,pinSpacing:!1,onUpdate:e=>{let t=e.progress,i=1-10*t,n=1-10*t;$(".hero-block .stoke-title").css({opacity:i}),$(".hero-block-scroll").css({opacity:n})}}})}if(document.querySelector(".xcode")){let t,i,n,s,o=document.querySelector(".xcode-cards"),r=gsap.utils.toArray(".xcode-cards .item");function updateXcodeMetrics(){t=r[0].offsetWidth,i=parseFloat(getComputedStyle(o).gap)||0,n=(t+i)*(r.length-1),s=(t+i)*(r.length-1)-(t-(8*i-10))}updateXcodeMetrics();let a={start:IsDestop?"top+=40%":"top+=30%"};function setActive(e){o.dataset.activeIndex&&o.dataset.activeIndex==e||(r.forEach((e=>e.classList.remove("active"))),r[e].classList.add("active"),o.dataset.activeIndex=e)}gsap.timeline({scrollTrigger:{trigger:".xcode",start:a.start,end:()=>`+=${IsDestop?n:s}`,pin:!0,scrub:1,onUpdate:e=>{const t=e.progress;setActive(Math.min(r.length-1,Math.floor(t*r.length)))}}}).to(".xcode-cards",{x:-(IsDestop?n:s),ease:"none"}),window.addEventListener("resize",(()=>{updateXcodeMetrics(),ScrollTrigger.refresh()}))}if(document.querySelector(".feedback")&&width>750&&gsap.set(".feedback-form, .guarantees-section",{yPercent:-92,scale:.3,xPercent:-35}),document.querySelector(".guarantees")){gsap.to(".guarantees-section",{yPercent:0,xPercent:0,scale:1,ease:"power1.inOut",scrollTrigger:{trigger:".guarantees__wrap",start:"top center",end:"+=70%",scrub:!0}});let c={scale:IsDestop?16:25,yPercent:IsDestop?-60:-80,start:IsDestop?"+=45%":"+=20%",end:IsDestop?"+=200%":"+=50%"};gsap.to(".guarantees-circle",{yPercent:c.yPercent,scale:c.scale,ease:"power1.inOut",rotate:90,scrollTrigger:{trigger:".guarantees",start:c.start,end:c.end,scrub:1,pin:!0,pinSpacing:!1}})}if(document.querySelector(".implementation")){let l={scale:IsDestop?15:25,yPercent:IsDestop?100:350,xPercent:IsDestop?-70:-0};gsap.to(".implementation .circle-hero",{scale:l.scale,yPercent:l.yPercent,xPercent:l.xPercent,scrollTrigger:{trigger:".implementation",start:"top top",end:"+=75%",scrub:1,pin:!0,pinSpacing:!1,onUpdate:e=>{let t=1-5*e.progress;$(".implementation .stoke-title").css({opacity:t})}}})}function splitLetters(){document.querySelectorAll(".split-light, .split-dark").forEach((e=>{if(e.querySelector(".char"))return;const t=e.textContent;let i="";for(let e=0;e<t.length;e++){const n=t[e];i+=" "===n||"\n"===n||"\t"===n?n:`<span class="char">${n}</span>`}e.innerHTML=i}))}function initScrollAnimations(){let e="#BEBFC3",t="#8F919A";document.querySelectorAll(".split-light, .split-dark").forEach((i=>{const n=i.querySelectorAll(".char");let s=i.classList.contains("split-light")?e:t;gsap.set(n,{color:s});const o=gsap.timeline({scrollTrigger:{trigger:i,start:"top 80%",end:"bottom 20%",scrub:1,onEnter:()=>{o.play()},onEnterBack:()=>{o.play()},onLeave:()=>{o.progress(1)},onLeaveBack:()=>{o.progress(0)}}});o.to(n,{color:"#fff",ease:"power2.out",stagger:{amount:.5,from:"start"},duration:.8})}))}if(document.querySelector(".feedback-form")&&width>750&&gsap.to(".feedback-form",{yPercent:0,xPercent:0,scale:1,ease:"power1.inOut",scrollTrigger:{trigger:".feedback-wrap",start:"top center",end:"+=70%",scrub:1}}),document.addEventListener("DOMContentLoaded",(()=>{splitLetters(),setTimeout((()=>{initScrollAnimations()}),100)})),window.addEventListener("resize",(()=>{ScrollTrigger.refresh()})),document.querySelector(".wrap-agency-animation")&&!IsDestop){document.querySelectorAll(".wrap-agency-animation .content").forEach(((e,t)=>{let i,n,s,o=e.querySelectorAll(".content__img");i=o[0].offsetWidth,n=parseFloat(getComputedStyle(e).gap)||0,s=(i+n)*(o.length-1)-(i-2*n);gsap.timeline({scrollTrigger:{trigger:e,start:"top bottom",end:()=>"+=100%",scrub:1}}).to(e,{x:-s,ease:"none"})}))}if(width>750){const d=document.querySelectorAll(".line path"),h=new Map;function updateLinePath(e,t,i){const n=100,s=500,o=Math.max(0,Math.min(2e3,i)),r=[{x:0,y:n},{x:o-250,y:n},{x:o,y:n+t},{x:o+250,y:n},{x:2e3,y:n}];let a=`M${r[0].x} ${r[0].y}`;a+=` L${r[1].x} ${r[1].y}`,a+=` C${r[1].x+125} ${r[1].y}, \n           ${r[2].x-s/6} ${r[2].y}, \n           ${r[2].x} ${r[2].y}`,a+=` C${r[2].x+s/6} ${r[2].y}, \n           ${r[3].x-125} ${r[3].y}, \n           ${r[3].x} ${r[3].y}`,a+=` L${r[4].x} ${r[4].y}`,e.setAttribute("d",a)}d.forEach((e=>{h.set(e,{depth:0,x:1e3,tween:null})})),document.addEventListener("mousemove",(e=>{d.forEach((t=>{const i=h.get(t),n=t.closest("svg").getBoundingClientRect(),s=n.top+n.height/2,o=Math.abs(e.clientY-s),r=o<80,a=1-Math.pow(o/80,1.5),c=r?Math.max(-80,Math.min(80,(s-e.clientY)*a*2.5)):0,l=2e3/n.width,d=(e.clientX-n.left)*l;i.tween&&i.tween.kill(),i.tween=gsap.to(i,{duration:.4,depth:c,x:d,ease:"power2.out",onUpdate:()=>{updateLinePath(t,i.depth,i.x)}})}))})),document.addEventListener("mouseleave",(()=>{d.forEach((e=>{const t=h.get(e);t.tween&&t.tween.kill(),t.tween=gsap.to(t,{duration:.8,depth:0,x:1e3,ease:"elastic.out(1, 0.4)",onUpdate:()=>{updateLinePath(e,t.depth,t.x)}})}))}))}function setupMarquee(e,{duration:t=25,enterX:i=0,scrollStart:n="top bottom",scrollEnd:s="+=100%"}={}){if(!e||!e.firstElementChild)return;const o=e.firstElementChild.scrollWidth+(parseFloat(getComputedStyle(e).gap)||0);gsap.killTweensOf(e),ScrollTrigger.getAll().forEach((t=>{t.trigger===e&&t.kill()})),gsap.set(e,{x:0}),gsap.to(e,{x:-o,duration:t,ease:"none",repeat:-1,modifiers:{x:e=>parseFloat(e)%-o+"px"}}),gsap.fromTo(e,{xPercent:i},{xPercent:0,ease:"power1.inOut",scrollTrigger:{trigger:e,start:n,end:s,scrub:1,markers:!1}})}function initMarquees(){document.querySelectorAll([".stoke-title .stroke-wrap",".agency-stroke:not(.special-margue-container .agency-stroke)",".longest__body .stroke-wrap",".case-frame .item .item-stroke-wrap",".footer-stroke",".about-stroke"].join(", ")).forEach((e=>{setupMarquee(e,{duration:15,enterX:0})})),document.querySelectorAll(".special-margue-container").forEach((e=>{e.style.transform="translateX(-60%)";const t=e.querySelector(".agency-stroke");t&&setupMarquee(t,{duration:15,enterX:60})}))}function isElementInViewport(e){const t=e.getBoundingClientRect();return t.top<=.6*window.innerHeight&&t.bottom>=.4*window.innerHeight}function updateActiveNav(){const e=document.querySelectorAll("section[id]"),t=document.querySelectorAll(".navbar .ancor-item"),i=document.querySelector(".home-btn");if(window.scrollY<50)return t.forEach((e=>e.parentElement.classList.remove("current"))),void(i&&i.parentElement.classList.add("current"));let n=!1;for(let s=e.length-1;s>=0;s--){const o=e[s];if(isElementInViewport(o)){const e=o.getAttribute("id"),s=document.querySelector(`.navbar .ancor-item[href="#${e}"]`);t.forEach((e=>e.parentElement.classList.remove("current"))),s&&(s.parentElement.classList.add("current"),i.parentElement.classList.remove("current"),n=!0);break}}n||t.forEach((e=>e.parentElement.classList.remove("current")))}gsap.registerPlugin(ScrollTrigger),window.addEventListener("resize",(()=>{clearTimeout(resizeTimeout),resizeTimeout=setTimeout((()=>{ScrollTrigger.refresh(!0),initMarquees()}),400)})),window.addEventListener("load",(()=>{setTimeout((()=>{initMarquees(),ScrollTrigger.refresh(!0)}),500)})),document.addEventListener("DOMContentLoaded",(function(){updateActiveNav()})),void 0!==lenis&&width>750&&lenis.on("scroll",updateActiveNav),window.addEventListener("resize",updateActiveNav),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".preloader"),t=document.querySelector(".line span"),i=document.querySelector(".procent");let n=0;const s=setInterval((()=>{n+=1.5;const e=Math.min(n,100);t.style.width=e+"%",i.textContent=Math.round(e)+"%","complete"===document.readyState&&(n=Math.max(n,0)),e>=100&&(clearInterval(s),"complete"===document.readyState?o():window.addEventListener("load",o))}),30);function o(){e.style.opacity="0",e.style.transition="opacity 0.5s ease",setTimeout((()=>{e.style.display="none"}),500)}setTimeout(o,5e3)}));